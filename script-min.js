document.addEventListener("DOMContentLoaded",function(){function y(a){a=a.toString();for(var e=/(-?\d+)(\d{3})/;e.test(a);)a=a.replace(e,"$1,$2");return a}var m=function(a){var e=["th","st","nd","rd"],t=a%100;return a+(e[(t-20)%10]||e[t]||e[0])},p="Hawaii",a=new URLSearchParams(window.location.search).get("state");if(a&&"Hawaii"!==(p=a)){var e=document.querySelector("#countyCasesContainer");e.parentNode.removeChild(e);var t=document.querySelector("#countyDeathsContainer");t.parentNode.removeChild(t);var s=document.querySelector("#hiDeptHealth");s.parentNode.removeChild(s)}document.getElementById("stateName").innerHTML=p;var o=new XMLHttpRequest;if(o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var a=Papa.parse(this.responseText),e={labels:[],datasets:[{label:"Cases",data:[],borderColor:"rgba(217, 136, 128,1)",backgroundColor:"rgba(217, 136, 128,0.2)"},{label:"Deaths",data:[],borderColor:"rgba(240, 178, 122,1)",backgroundColor:"rgba(240, 178, 122,0.2)"}]},t={},s={cases:{beginDate:null,days:null},deaths:{beginDate:null,days:null}};a.data.forEach(function(a){a[1]===p&&(e.labels.includes(a[0])||e.labels.push(a[0]),e.datasets[0].data.push({x:a[0],y:a[3]}),e.datasets[1].data.push({x:a[0],y:a[4]}),s.cases.beginDate||1<=a[3]&&(s.cases.beginDate=a[0]),s.deaths.beginDate||1<=a[4]&&(s.deaths.beginDate=a[0])),t[a[1]]={state:a[1],cases:parseInt(a[3]),deaths:parseInt(a[4])}});var o=Object.values(t);o.sort(function(a,e){return e.cases-a.cases}),o.shift();var d=Object.values(t);d.sort(function(a,e){return e.deaths-a.deaths}),d.shift();var n={cases:{rank:null,total:o.length},deaths:{rank:null,total:o.length}};o.forEach(function(a,e){a.state===p&&(n.cases.rank=e+1)}),d.forEach(function(a,e){a.state===p&&(n.deaths.rank=e+1)}),document.getElementById("caseRanking").innerHTML=p+" is ranked "+m(n.cases.rank)+" out of "+n.cases.total+" states & territories.",document.getElementById("deathRanking").innerHTML=p+" is ranked "+m(n.deaths.rank)+" out of "+n.cases.total+" states & territories.",s.cases.beginDate||(s.cases.beginDate=new Date),s.deaths.beginDate||(s.deaths.beginDate=new Date);var r=moment(new Date);s.cases.days=r.diff(s.cases.beginDate,"days"),s.deaths.days=r.diff(s.deaths.beginDate,"days");var l=document.getElementById("caseDays");l.innerHTML=s.cases.days+" "+(1===s.cases.days?"day":"days")+" since the first case was reported.";var i=document.getElementById("deathDays");i.innerHTML=s.deaths.days+" "+(1===s.deaths.days?"day":"days")+" since the first death was reported.";var c=e.datasets[0].data[e.datasets[0].data.length-1].y-e.datasets[0].data[e.datasets[0].data.length-2].y,u=document.getElementById("caseDiffFromPrevDay");u.innerHTML="(^"+y(c)+")",c<=0?u.classList.add("less"):u.classList.add("more"),new CountUp("cases",0,e.datasets[0].data[e.datasets[0].data.length-1].y).start(function(){u.classList.add("show"),l.classList.add("show"),document.getElementById("caseRanking").classList.add("show")});var g=e.datasets[1].data[e.datasets[1].data.length-1].y-e.datasets[1].data[e.datasets[1].data.length-2].y,b=document.getElementById("deathDiffFromPrevDay");b.innerHTML="(^"+y(g)+")",g<=0?b.classList.add("less"):b.classList.add("more"),new CountUp("deaths",0,e.datasets[1].data[e.datasets[1].data.length-1].y).start(function(){b.classList.add("show"),i.classList.add("show"),document.getElementById("deathRanking").classList.add("show")});var h=document.getElementById("state"),f=(new Chart(h,{type:"line",data:e,options:{title:{display:!0,fontColor:"#FFF",fontSize:20,text:"Cases and Deaths - State of "+p},legend:{labels:{fontColor:"#fff",fontStyle:"bold"}},scales:{yAxes:[{gridLines:{color:"rgba(255,255,255,0.3)"},ticks:{color:"rgba(255,255,255,0.3)",fontColor:"#fff"}}],xAxes:[{gridLines:{color:"rgba(255,255,255,0.3)"},ticks:{color:"rgba(255,255,255,0.3)",fontColor:"#fff"}}]}}}),a.data[a.data.length-1][0]);document.getElementById("stateUpdate").innerHTML="Updated "+f}},o.open("GET","https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv",!0),o.send(),"Hawaii"===p){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var a=Papa.parse(this.responseText),e={cases:{labels:[],datasets:[{label:"Hawaii",data:[],borderColor:"rgba(217, 136, 128,1)",backgroundColor:"rgba(217, 136, 128,0.2)"},{label:"Honolulu",data:[],borderColor:"rgba(247, 220, 111,1)",backgroundColor:"rgba(247, 220, 111,0.2)"},{label:"Kauai",data:[],borderColor:"rgba(187, 143, 206,1)",backgroundColor:"rgba(187, 143, 206,0.2)"},{label:"Maui",data:[],borderColor:"rgba(125, 206, 160,1)",backgroundColor:"rgba(125, 206, 160,0.2)"}]},deaths:{labels:[],datasets:[{label:"Hawaii",data:[],borderColor:"rgba(217, 136, 128,1)",backgroundColor:"rgba(217, 136, 128,0.2)"},{label:"Honolulu",data:[],borderColor:"rgba(247, 220, 111,1)",backgroundColor:"rgba(247, 220, 111,0.2)"},{label:"Kauai",data:[],borderColor:"rgba(187, 143, 206,1)",backgroundColor:"rgba(187, 143, 206,0.2)"},{label:"Maui",data:[],borderColor:"rgba(125, 206, 160,1)",backgroundColor:"rgba(125, 206, 160,0.2)"}]}};a.data.forEach(function(a){"Hawaii"!==a[1]&&"Honolulu"!==a[1]&&"Kauai"!==a[1]&&"Maui"!==a[1]||(e.cases.labels.includes(a[0])||e.cases.labels.push(a[0]),e.cases.labels.includes(a[0])||e.cases.labels.push(a[0]),"Hawaii"===a[1]&&(e.cases.datasets[0].data.push({x:a[0],y:a[4]}),e.deaths.datasets[0].data.push({x:a[0],y:a[5]})),"Honolulu"===a[1]&&(e.cases.datasets[1].data.push({x:a[0],y:a[4]}),e.deaths.datasets[1].data.push({x:a[0],y:a[5]})),"Kauai"===a[1]&&(e.cases.datasets[2].data.push({x:a[0],y:a[4]}),e.deaths.datasets[2].data.push({x:a[0],y:a[5]})),"Maui"===a[1]&&(e.cases.datasets[3].data.push({x:a[0],y:a[4]}),e.deaths.datasets[3].data.push({x:a[0],y:a[5]})))});var t=document.getElementById("countyCases"),s=(new Chart(t,{type:"line",data:e.cases,options:{title:{display:!0,fontColor:"#FFF",fontSize:20,text:"Cases - State of Hawaii Counties"},legend:{labels:{fontColor:"#fff",fontStyle:"bold"}},scales:{yAxes:[{gridLines:{color:"rgba(255,255,255,0.3)"},ticks:{color:"rgba(255,255,255,0.3)",fontColor:"#fff"}}],xAxes:[{gridLines:{color:"rgba(255,255,255,0.3)"},ticks:{color:"rgba(255,255,255,0.3)",fontColor:"#fff"}}]}}}),document.getElementById("countyDeaths")),o=(new Chart(s,{type:"line",data:e.deaths,options:{title:{display:!0,fontColor:"#FFF",fontSize:20,text:"Deaths - State of Hawaii Counties"},legend:{labels:{fontColor:"#fff",fontStyle:"bold"}},scales:{yAxes:[{gridLines:{color:"rgba(255,255,255,0.3)"},ticks:{color:"rgba(255,255,255,0.3)",fontColor:"#fff",beginAtZero:!0}}],xAxes:[{gridLines:{color:"rgba(255,255,255,0.3)"},ticks:{color:"rgba(255,255,255,0.3)",fontColor:"#fff"}}]}}}),a.data[a.data.length-1][0]);document.getElementById("countyCaseUpdate").innerHTML="Updated "+o,document.getElementById("countyDeathUpdate").innerHTML="Updated "+o}},d.open("GET","https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv",!0),d.send()}});